generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String           @id @default(cuid())
  email           String           @unique
  emailVerified   Boolean          @default(false)
  name            String?
  image           String?
  role            String           @default("user")
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  accounts        Account[]
  albums          Album[]
  contentVersions ContentVersion[]
  services        Service[]
  sessions        Session[]
  videos          Video[]
  resumeEntries   ResumeEntry[]
  activityLogs    ActivityLog[]
  exportLogs      ExportLog[]

  @@map("users")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  expiresAt DateTime
  token     String   @unique
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model Account {
  id             String    @id @default(cuid())
  userId         String
  providerId     String
  providerUserId String?
  password       String?
  accessToken    String?
  refreshToken   String?
  expiresAt      DateTime?
  accountId      String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, providerUserId])
  @@index([userId])
  @@map("accounts")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime

  @@unique([identifier, value])
  @@map("verifications")
}

model Album {
  id             String   @id @default(cuid())
  title          String
  img            String
  poster         String
  date           String
  sortedDate     String
  style          String
  listenLink     String
  spotifyEmbed   String?
  youtubeEmbed   String?
  collabName     String?
  collabLink     String?
  descriptionsFr String
  descriptionsEn String
  published      Boolean  @default(true)
  order          Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdById    String?
  createdBy      User?    @relation(fields: [createdById], references: [id])

  @@index([published, sortedDate])
  @@index([style])
  @@map("albums")
}

model Video {
  id          String   @id @default(cuid())
  img         String?
  type        String
  videoId     String
  title       String
  date        String
  published   Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById String?
  createdBy   User?    @relation(fields: [createdById], references: [id])

  @@index([published, date])
  @@index([type])
  @@map("videos")
}

model Service {
  id              String   @id @default(cuid())
  no              String
  title           String
  text            String
  largeImg        String
  largeTitle      String
  poster          String
  date            String
  author          String
  fullDescription String
  descriptionsFr  String
  descriptionsEn  String
  published       Boolean  @default(true)
  order           Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String?
  createdBy       User?    @relation(fields: [createdById], references: [id])

  @@index([published, order])
  @@map("services")
}

model ContentVersion {
  id          String   @id @default(cuid())
  contentType String
  contentId   String
  version     Int
  data        Json
  changes     Json?
  action      String   @default("update")
  createdById String
  createdAt   DateTime @default(now())
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([contentType, contentId, version])
  @@index([contentType, contentId, createdAt(sort: Desc)])
  @@index([createdAt(sort: Desc)])
  @@map("content_versions")
}

model NavigationItem {
  id        String   @id @default(cuid())
  icon      String
  menuName  String
  routePath String
  order     Int      @default(0)
  published Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([published, order])
  @@map("navigation_items")
}

model SiteSettings {
  id              String  @id @default("site_settings")
  // Informations générales
  siteTitle       String  @default("Loïc Ghanem | Music Composer & Producer")
  siteDescription String  @default("Award-winning music composer and producer")
  contactEmail    String  @default("contact@loicghanem.com")
  contactPhone    String?
  location        String  @default("Paris, France")
  footerBio       String?

  // Réseaux sociaux
  socialYoutube    String?
  socialInstagram  String?
  socialFacebook   String?
  socialTwitter    String?
  socialLinkedin   String?
  socialSoundcloud String?
  socialSpotify    String?
  socialAppleMusic String?
  socialBandcamp   String?
  socialTiktok     String?

  // Paramètres de contenu
  homepageFeaturedAlbumsCount Int    @default(6)
  homepageLatestVideosCount   Int    @default(6)
  albumsPerPage               Int    @default(12)
  videosPerPage               Int    @default(12)
  servicesPerPage             Int    @default(10)
  defaultAlbumSort            String @default("date_desc")
  defaultVideoSort            String @default("date_desc")

  // Apparence
  homepageWelcomeMessage String?
  showFeaturedAlbums     Boolean @default(true)
  showLatestVideos       Boolean @default(true)
  showServices           Boolean @default(true)

  // Maintenance
  maintenanceMode    Boolean @default(false)
  maintenanceMessage String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("site_settings")
}

model ResumeEntry {
  id            String  @id @default(cuid())
  type          String // EXPERIENCE, EDUCATION, SKILL, LANGUAGE, INTEREST, KNOWLEDGE
  titleEn       String
  titleFr       String
  subtitleEn    String?
  subtitleFr    String?
  dateRangeEn   String?
  dateRangeFr   String?
  descriptionEn String?
  descriptionFr String?
  value         Int? // 0-100 for progress bars
  link          String?
  order         Int     @default(0)
  published     Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdById String?
  createdBy   User?   @relation(fields: [createdById], references: [id])

  @@index([type, order])
  @@map("resume_entries")
}

model ResumeProfile {
  id         String   @id @default("default_profile")
  name       String
  roleEn     String
  roleFr     String
  headlineEn String?
  headlineFr String?
  email      String
  phone      String?
  location   String?
  website    String?
  photo      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("resume_profile")
}

model ResumeTheme {
  id           String   @id @default("default_theme")
  primary      String
  secondary    String
  accent       String
  muted        String
  sidebar      String
  divider      String
  gradientFrom String
  gradientTo   String
  tagBg        String
  tagText      String
  fontHeadings String
  fontBody     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("resume_theme")
}

model ResumeSection {
  id        String   @id @default(cuid())
  slug      String   @unique
  titleEn   String?
  titleFr   String?
  type      String // PROFILE, TIMELINE, SKILL_BARS, TAG_CLOUD, SIDEBAR_LIST, QUOTE, STATS
  entryType String?
  entryIds  Json?
  order     Int      @default(0)
  published Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([published, order])
  @@map("resume_sections")
}

// ============================================
// CV / Resume (new layout)
// ============================================

model CV {
  id       String  @id @default(cuid())
  isActive Boolean @default(true)

  // Personal info
  fullName    String?
  badgeFr     String?
  badgeEn     String?
  photo       String?
  phone       String?
  email       String?
  website     String?
  location    String?
  linkedInUrl String?

  // Bio/Headline (multilingual)
  headlineFr String?
  headlineEn String?
  bioFr      String? @db.Text
  bioEn      String? @db.Text

  // Layout settings
  layout      String  @default("creative")
  accentColor String  @default("#D5FF0A")
  showPhoto   Boolean @default(true)
  theme       Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sections    CVSection[]
  skills      CVSkill[]
  socialLinks CVSocialLink[]
  versions    CVVersion[]

  @@map("cv")
}

model CVSection {
  id         String   @id @default(cuid())
  cvId       String
  cv         CV       @relation(fields: [cvId], references: [id], onDelete: Cascade)
  type       String
  icon       String?
  color      String?
  placement  String   @default("main")
  layoutType String   @default("list")
  order      Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  translations CVSectionTranslation[]
  items        CVItem[]

  @@index([cvId])
  @@index([order])
  @@map("cv_section")
}

model CVSectionTranslation {
  id        String    @id @default(cuid())
  sectionId String
  section   CVSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  locale    String
  title     String

  @@unique([sectionId, locale])
  @@index([locale])
  @@map("cv_section_translation")
}

model CVItem {
  id        String    @id @default(cuid())
  sectionId String
  section   CVSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  startDate DateTime?
  endDate   DateTime?
  isCurrent Boolean   @default(false)
  order     Int       @default(0)
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  translations CVItemTranslation[]

  @@index([sectionId])
  @@index([order])
  @@map("cv_item")
}

model CVItemTranslation {
  id          String  @id @default(cuid())
  itemId      String
  item        CVItem  @relation(fields: [itemId], references: [id], onDelete: Cascade)
  locale      String
  title       String
  subtitle    String?
  location    String?
  description String? @db.Text

  @@unique([itemId, locale])
  @@index([locale])
  @@map("cv_item_translation")
}

model CVSkill {
  id        String   @id @default(cuid())
  cvId      String
  cv        CV       @relation(fields: [cvId], references: [id], onDelete: Cascade)
  category  String
  level     Int      @default(3)
  showAsBar Boolean  @default(true)
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  translations CVSkillTranslation[]

  @@index([cvId])
  @@index([category])
  @@map("cv_skill")
}

model CVSkillTranslation {
  id      String  @id @default(cuid())
  skillId String
  skill   CVSkill @relation(fields: [skillId], references: [id], onDelete: Cascade)
  locale  String
  name    String

  @@unique([skillId, locale])
  @@index([locale])
  @@map("cv_skill_translation")
}

model CVSocialLink {
  id        String   @id @default(cuid())
  cvId      String
  cv        CV       @relation(fields: [cvId], references: [id], onDelete: Cascade)
  platform  String
  url       String
  label     String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([cvId])
  @@map("cv_social_link")
}

model CVVersion {
  id        String   @id @default(cuid())
  cvId      String?
  cv        CV?      @relation(fields: [cvId], references: [id], onDelete: Cascade)
  name      String
  data      Json
  createdAt DateTime @default(now())

  @@index([cvId, createdAt])
  @@map("cv_version")
}

// ============================================
// Notifications Admin
// ============================================

model Notification {
  id        String   @id @default(cuid())
  type      String // "new_content" | "contact_message"
  title     String
  message   String
  read      Boolean  @default(false)
  data      Json? // { contentType: "album", contentId: "xxx", locale: "fr" }
  createdAt DateTime @default(now())

  @@index([read, createdAt(sort: Desc)])
  @@map("notifications")
}

// ============================================
// Activity Logs (Journal d'activité)
// ============================================

model ActivityLog {
  id          String   @id @default(cuid())
  type        String // "auth" | "export" | "crud" | "settings"
  action      String // "login" | "logout" | "create" | "update" | "delete" | "export" | "password_change" | "email_change"
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  entityType  String? // "album" | "video" | "service" | null
  entityId    String?
  entityTitle String? // Titre du contenu pour affichage
  details     Json? // Détails supplémentaires
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@index([type])
  @@index([userId])
  @@index([createdAt(sort: Desc)])
  @@map("activity_logs")
}

model ExportLog {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type      String // "albums" | "videos" | "services" | "contacts"
  format    String // "csv" | "json" | "txt"
  filename  String
  content   String   @db.Text // Contenu de l'export stocké
  fileSize  Int // Taille en bytes
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([createdAt(sort: Desc)])
  @@map("export_logs")
}

// ============================================
// Testimonials (Avis clients)
// ============================================

model Testimonial {
  id        String   @id @default(cuid())
  name      String // Nom du client
  role      String // Role/titre (ex: "Vocalist", "Topliner")
  avatar    String? // Chemin vers l'image avatar
  text      String   @db.Text // Contenu du témoignage
  date      String? // Date affichée (ex: "2 months ago")
  rating    Int      @default(5) // Note sur 5
  source    String? // Source (ex: "SoundBetter")
  sourceUrl String? // URL vers la source
  order     Int      @default(0)
  published Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([published, order])
  @@map("testimonials")
}
